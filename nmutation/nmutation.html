<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* center input */
        body {
            margin: 0;
            padding: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: monospace;
        }

        input {
            font-size: 24px;
            width: 250px;
            text-align: center;
        }

        h1 {
            font-size: 32px;
        }

        @keyframes rr {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }

            50% {
                transform: translate(0, 0) rotate(60deg);
            }

            100% {
                transform: translate(0, 0) rotate(0deg);
            }
        }

        .rr-anim {
            animation: rr 0.1s ease-in-out;
        }
    </style>
    <script>
        // include gen.js
        function getRandomInt(max) {
            return Math.floor(Math.random() * max);
        }

        function last_divisor(n) {
            for (let i = n - 1; i >= 1; i--) {
                if (n % i === 0) {
                    return i;
                }
            }
            return 1;
        }

        function mutate(n) {
            let a = getRandomInt(n) + 1;

            switch (getRandomInt(4)) {
                case 0: return `(${a} + ${n - a})`;
                case 1: return `(${a + n} - ${a})`;
                case 2: {
                    if (n > 999)
                    {
                        return mutate(n);
                    }
                    if (a === 0) {
                        return `(${n} * 1)`;
                    } else {
                        return `(${n * a} / ${a})`;
                    }
                }
                case 3: {
                    if (n > 999)
                    {
                        return mutate(n);
                    }
                    let d = last_divisor(n);
                    if (d === n) {
                        d = 1;
                    }
                    return `(${n / d} * ${d})`;
                }
            }
        }

        function walk(buf, skip_chance = 0.2) {
            return buf.replace(/\d+/g, (match) => {
                if (Math.random() < skip_chance) {
                    return match;
                }
                return mutate(parseInt(match));
            });
        }

    </script>
</head>

<body>
    <input type="text" placeholder="enter your number">
    <h1 hidden></h1>
    <script>
        function isPageVerticallyScrollable() {
            return document.documentElement.scrollHeight > document.documentElement.clientHeight;
        }

        let font_size = 32;
        const input = document.querySelector('input');
        const h1 = document.querySelector('h1');

        function upd(e) {
            console.log(e);
            let val;
            if (e.key === 'Enter' || e.type === 'click') {
                if (input.hidden) {
                    val = h1.textContent;
                } else {
                    val = input.value;
                }
                const result = walk(val);
                h1.classList.remove('rr-anim');
                void h1.offsetWidth;
                h1.classList.add('rr-anim');
                if (!input.hidden)
                {
                    input.hidden = true;
                    h1.hidden = false;
                }
                h1.textContent = result;
                if (isPageVerticallyScrollable()) {
                    font_size = font_size - 12;
                    h1.style.fontSize = `${font_size}px`;
                }
            }
        }

        document.addEventListener('keydown', upd);
        h1.addEventListener('click', upd);
    </script>
</body>

</html>